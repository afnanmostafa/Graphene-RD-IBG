#Interlayer bonded Bilayer Graphene with random isolated bonds + passivation by H

dimension 3
units metal
processors * 1 1
boundary p p p
neighbor 0.3 bin
neigh_modify every 1 delay 0 check yes
#define variables

variable T equal 300.0
variable V equal lx*ly*6.7  # 3.35 (1st layer) + gap (0) + 3.35 (2nd layer)
variable dt equal 0.0001
#define lattice

atom_style atomic
read_data gr10x10aa_10.00BD.data
#define interatomic potentials

pair_style			airebo 3 1 0
pair_coeff 			* * CH.airebo C C H
dump 1 all xyz 1000 bondnew.xyz
dump_modify 1 sort id
#define thermo variable settings

timestep ${dt}

#### BOND FORMATION ####

group atom1 id 	2647 3307 393 1877 2145 1055 1987 949 1157 1635 1525 2767 305 1737 2487 2695 647 2621 3769 2281 1499 3175 215 2637 2925 2759 1171 2321 3451 1971 2289 945 3787 2891 27 2899 1869 1087 901 1359 3629 1285 3567 1439 973 3505 1537 2931 3477 433 833 2147 2793 3679 3801 1763 891 1307 425 1983 1855 3701 2743 2763 1451 201 549 1793 3599 3509 1447 59 1315 2423 2537 2299 2715 3775 597 3243 255 2625 3333 2555 291 1673 2669 3573 1069 3179 3989 2053 879 111 2665 2457 1565 3119 619 1523 1647 2151 3767 1249 3167 1797 3725 3135 1493 1051 2435 3561 3077 2133 1459 465 2515 2317 3053 2463 1569 531 1053 969 2169 4009 2919 2667 3137 1655 1327 3411 1961 2029 3209 1651 2727 2567 223 1221 1807 1885 1625 3579 3685 1413 2191 397 1959 739 321 2897 1505 3181 581 3921 2713 1077 645 103 667 2025 3407 2745 1331 3791 605 977 3641 2601 2297 1433 2827 2201 2481 823 2221 2513 2045 2725 2313 1349 1387 3589 

group atom2 id 	6679 7339 4425 5909 6177 5087 6019 4981 5189 5667 5557 6799 4337 5769 6519 6727 4679 6653 7801 6313 5531 7207 4247 6669 6957 6791 5203 6353 7483 6003 6321 4977 7819 6923 4059 6931 5901 5119 4933 5391 7661 5317 7599 5471 5005 7537 5569 6963 7509 4465 4865 6179 6825 7711 7833 5795 4923 5339 4457 6015 5887 7733 6775 6795 5483 4233 4581 5825 7631 7541 5479 4091 5347 6455 6569 6331 6747 7807 4629 7275 4287 6657 7365 6587 4323 5705 6701 7605 5101 7211 8021 6085 4911 4143 6697 6489 5597 7151 4651 5555 5679 6183 7799 5281 7199 5829 7757 7167 5525 5083 6467 7593 7109 6165 5491 4497 6547 6349 7085 6495 5601 4563 5085 5001 6201 8041 6951 6699 7169 5687 5359 7443 5993 6061 7241 5683 6759 6599 4255 5253 5839 5917 5657 7611 7717 5445 6223 4429 5991 4771 4353 6929 5537 7213 4613 7953 6745 5109 4677 4135 4699 6057 7439 6777 5363 7823 4637 5009 7673 6633 6329 5465 6859 6233 6513 4855 6253 6545 6077 6757 6345 5381 5419 7621 

displace_atoms atom1 move 0 0 1.15 units box
displace_atoms atom2 move 0 0 -1.15 units box

# ======= grouping bonded and non-bonded atoms ======= #

group bonded union atom1 atom2
group nonbonded subtract all bonded

# ======= thermodynamics output setting ======= #

thermo_style    	custom step time temp press pxx pyy pzz pe ke etotal
thermo          	1000

# ======= minimization ======= #

min_style		cg
fix 			1 all box/relax x 0.0 y 0.0 z 0.0 couple xyz
minimize		0 1e-10 200000 400000
unfix			1

# ======= equilibration ======= #

fix 2 all recenter INIT INIT INIT

fix 1 nonbonded npt temp $T $T 0.1 x 0.0 0.0 1.0 y 0.0 0.0 1.0 couple xy
run 50000
unfix 1

fix 1 all npt temp $T $T 0.1 x 0.0 0.0 1.0 y 0.0 0.0 1.0 couple xy
run 50000
unfix 1
unfix 2

fix NVE all nve
fix				ts all temp/rescale 1 $T $T $(100.0*dt) 1.0
run 50000
unfix     ts
unfix     NVE

# ======= write output ======= #

write_data post_equil.data
